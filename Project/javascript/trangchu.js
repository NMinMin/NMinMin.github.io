// ------------------ 1. T·∫†O SLIDER S·∫¢N PH·∫®M M·ªöI ------------------
fetch('https://opensheet.elk.sh/15HwqsZC133Iiop7kwd-8R8pbdUewvLKjbJHJSnUUfzg/Trang%20t%C3%ADnh1')
  .then(res => res.json())
  .then(data => {
    const sliderContainer = document.getElementById('hero-slider-container');
    data.forEach(item => {
      const img = document.createElement('img');
      img.src = item.image;
      img.alt = item.name;
      sliderContainer.appendChild(img);
    });

    let currentIndex = 0;
    setInterval(() => {
      currentIndex = (currentIndex + 1) % data.length;
      sliderContainer.style.transform = `translateX(-${currentIndex * 100}vw)`;
    }, 3000);
  });

//Add items to cart
function addToCart(productId) {
  fetch('https://opensheet.elk.sh/1nV1tWbJoCXbWgICD0tuF8psj0uOHvNQPw1nSvXG_igQ/Trang%20t%C3%ADnh1')
    .then(res => res.json())
    .then(products => {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      const existing = cart.find(item => item.id === productId);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: product.name,
          price: parseFloat(product.price),
          image: product.image,
          quantity: 1
        });
      }

      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      alert('üõí S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!');
    });
}


// ------------------ 2. HI·ªÇN TH·ªä S·∫¢N PH·∫®M N·ªîI B·∫¨T + RATING ------------------
fetch('https://opensheet.elk.sh/1nV1tWbJoCXbWgICD0tuF8psj0uOHvNQPw1nSvXG_igQ/Trang%20t%C3%ADnh1')
  .then(res => res.json())
  .then(products => {
    const productsContainer = document.getElementById('products-container');

    products.forEach(product => {
      const productCard = document.createElement('div');
      productCard.classList.add('product-card', 'fade-in');
      // H√†m ƒë·ªãnh d·∫°ng gi√°
      function formatCurrency(amount) {
        // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã th√†nh s·ªë (n·∫øu ch∆∞a ph·∫£i l√† s·ªë)
        const number = parseFloat(amount);

        // Ki·ªÉm tra xem gi√° tr·ªã c√≥ h·ª£p l·ªá kh√¥ng
        if (isNaN(number)) return amount;

        return number.toLocaleString('vi-VN');  // ƒê·ªãnh d·∫°ng theo ki·ªÉu Vi·ªát Nam (1,000,000)
      }
      if (product.op == "n·ªïi b·∫≠t") {
        // S·ª≠a l·∫°i ph·∫ßn HTML c·ªßa s·∫£n ph·∫©m
        productCard.innerHTML = `
      <img src="${product.image}" alt="${product.name}">
      <div class="product-info">
        <h3>${product.name}</h3>
        <p>${product.description}</p>
        <div class="rating" data-rating="${product.rating}"></div>
        <p class="price"><strong>Gi√°:</strong> ${formatCurrency(product.price)} VND</p>  <!-- Hi·ªÉn th·ªã gi√° ƒë·ªãnh d·∫°ng -->
        
        <p><strong>ƒê√£ b√°n:</strong> ${product.sales}</p>
        <button class="add-to-cart-btn" data-id="${product.id}">
          <svg xmlns="http://www.w3.org/2000/svg" height="32px" viewBox="0 -960 960 960" width="32px" fill="#e8eaed">
            <path d="M280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM246-720l96 200h280l110-200H246Zm-38-80h590q23 0 35 20.5t1 41.5L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68-39.5t-2-78.5l54-98-144-304H40v-80h130l38 80Zm134 280h280-280Z"/>
          </svg>Mua ngay
        </button>
      </div>
    `;


        productsContainer.appendChild(productCard);

        renderRating(productCard.querySelector(".rating"), parseFloat(product.rating));
      }
    });
    // G·∫Øn s·ª± ki·ªán Th√™m v√†o gi·ªè h√†ng
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const productId = btn.getAttribute('data-id');
        addToCart(productId);

      });
    });

    checkFadeIn(); // Check hi·ªáu ·ª©ng khi render xong s·∫£n ph·∫©m
  });
// ------------------ 3. HI·ªÜU ·ª®NG CU·ªòN ------------------
function isInView(element) {
  const rect = element.getBoundingClientRect();
  return rect.top <= window.innerHeight && rect.bottom >= 0;
}

function checkFadeIn() {
  const fadeInElements = document.querySelectorAll('.fade-in');
  fadeInElements.forEach(element => {
    if (isInView(element)) {
      element.classList.add('visible');
    }
  });
}

window.addEventListener('scroll', checkFadeIn);

// ------------------ 4. RENDER RATING ------------------
function renderRating(element, rating) {
  const full = Math.floor(rating);
  const half = rating % 1 >= 0.25 && rating % 1 < 0.75;
  const totalStars = 5;

  let starsHTML = '';
  for (let i = 0; i < full; i++) starsHTML += fullStarSVG;
  if (half) starsHTML += halfStarSVG;
  for (let i = 0; i < totalStars - full - (half ? 1 : 0); i++) starsHTML += emptyStarSVG;

  element.innerHTML = starsHTML;
}

// ------------------ 5. GI·ªé H√ÄNG LOCALSTORAGE + ƒê·∫æM ------------------
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function addToCart(productId) {
  fetch('https://opensheet.elk.sh/1nV1tWbJoCXbWgICD0tuF8psj0uOHvNQPw1nSvXG_igQ/Trang%20t%C3%ADnh1')
    .then(res => res.json())
    .then(products => {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      const existing = cart.find(item => item.id === productId);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: product.name,
          price: parseFloat(product.price),
          image: product.image,
          quantity: 1
        });
      }

      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      alert('üõí S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!');
    });
}


function updateCartCount() {
  const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
  const cartCountElem = document.getElementById('cart-count');
  if (cartCountElem) {
    cartCountElem.textContent = cartCount;
  }
}

updateCartCount(); // Khi v·ª´a load trang

// ------------------ 6. SVG SAO ------------------
const fullStarSVG = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#FBC02D">
  <path d="m354-287 126-76 126 77-33-144 111-96-146-13-58-136-58 135-146 13 111 97-33 143Z"/>
</svg>`;

const halfStarSVG = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#FBC02D">
  <path d="m606-286-33-144 111-96-146-13-58-136v312l126 77Z"/>
</svg>`;

const emptyStarSVG = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#E0E0E0">
  <path d="m354-287 126-76 126 77-33-144 111-96-146-13-58-136-58 135-146 13 111 97-33 143Z"/>
</svg>`;

// ------------------ 7. X·ª¨ L√ù T√ÄI KHO·∫¢N ƒêƒÇNG NH·∫¨P ------------------
document.addEventListener('DOMContentLoaded', () => {
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  const navLinks = document.querySelectorAll('header nav ul li a');

  navLinks.forEach(link => {
    if (link.getAttribute('href') === '#account') {
      link.textContent = currentUser ? `Xin ch√†o, ${currentUser.name}` : 'T√†i Kho·∫£n';
    }
  });
});

// Tu dong cap nhat gio hang

// 1. H√†m l·∫•y gi·ªè h√†ng t·ª´ localStorage

function getCart() {

  return JSON.parse(localStorage.getItem('cart')) || [];

}



// 2. H√†m l∆∞u gi·ªè h√†ng v√†o localStorage

function saveCart(cart) {

  localStorage.setItem('cart', JSON.stringify(cart));

}



// 3. H√†m c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng trong th·∫ª <span id="cart-count">

function updateCartCount() {

  const cart = JSON.parse(localStorage.getItem('cart')) || [];



  const cartCount = cart.reduce((sum, item) => {

    const quantity = parseInt(item.quantity, 10);

    return sum + (isNaN(quantity) ? 0 : quantity);

  }, 0);



  const cartCountElem = document.getElementById('cart-count');

  if (cartCountElem) {

    cartCountElem.textContent = cartCount;

  }

}





// 4. H√†m th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng

function addToCart(productId) {

  fetch('https://opensheet.elk.sh/1nV1tWbJoCXbWgICD0tuF8psj0uOHvNQPw1nSvXG_igQ/Trang%20t%C3%ADnh1')

    .then(res => res.json())

    .then(products => {

      const product = products.find(p => p.id === productId);

      if (!product) return;



      let cart = JSON.parse(localStorage.getItem('cart')) || [];



      const existing = cart.find(item => item.id === productId);

      if (existing) {

        existing.quantity += 1;

      } else {

        cart.push({

          id: productId,

          name: product.name,

          price: parseFloat(product.price),

          image: product.image,

          quantity: 1

        });

      }



      localStorage.setItem('cart', JSON.stringify(cart)); // ‚úÖ L∆∞u gi·ªè h√†ng

      console.log(JSON.parse(localStorage.getItem('cart'))); // ‚úÖ In gi·ªè h√†ng ra console



      updateCartCount();

      alert('üõí S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!');

    });

}









// 5. G·ªçi khi DOM ƒë√£ s·∫µn s√†ng

document.addEventListener('DOMContentLoaded', () => {

  const cartContainer = document.getElementById('cart-items-container');

  const cart = JSON.parse(localStorage.getItem('cart')) || [];



  if (cart.length === 0) {

    cartContainer.innerHTML = '<p>Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</p>';

    return;

  }



  let totalPrice = 0;



  cart.forEach(item => {

    const productElem = document.createElement('div');

    productElem.classList.add('cart-item');



    productElem.innerHTML = `

¬† ¬† ¬† <img src="${item.image}" alt="${item.name}" width="100">

¬† ¬† ¬† <h3>${item.name}</h3>

¬† ¬† ¬† <p>Gi√°: ${item.price.toLocaleString('vi-VN')} VND</p>

¬† ¬† ¬† <p>S·ªë l∆∞·ª£ng: ${item.quantity}</p>

¬† ¬† `;



    cartContainer.appendChild(productElem);



    totalPrice += item.price * item.quantity; // T√≠nh t·ªïng ti·ªÅn

  });



  const totalElement = document.getElementById('total');

  totalElement.innerText = `T·ªïng ti·ªÅn: ${totalPrice.toLocaleString('vi-VN')} VND`;

});
